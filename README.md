# üìö History Learning App

–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–µ –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è –∏–∑—É—á–µ–Ω–∏—è –∏—Å—Ç–æ—Ä–∏–∏ —Å –≤–∏–∫—Ç–æ—Ä–∏–Ω–∞–º–∏, —Å–∏—Å—Ç–µ–º–æ–π –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –∏ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–æ–π –∫–∞—Ä—Ç–æ–π.

## üöÄ –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫

- **Frontend**: Next.js 16, React 19, TypeScript
- **Styling**: Tailwind CSS
- **Backend**: Supabase (PostgreSQL)
- **Authentication**: Supabase Auth
- **Maps**: Leaflet + react-leaflet
- **Components**: Framer Motion, rc-slider, rc-tooltip

## üìã –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Node.js 18+
- npm –∏–ª–∏ yarn
- Supabase –ø—Ä–æ–µ–∫—Ç ([—Å–æ–∑–¥–∞—Ç—å](https://supabase.com))

## üîß –£—Å—Ç–∞–Ω–æ–≤–∫–∞

### 1. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è

```bash
git clone <–≤–∞—à-—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π>
cd my-history-app
```

### 2. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```bash
npm install
```

### 3. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Supabase –ë–î

**[–í–ê–ñ–ù–û] –°–º–æ—Ç—Ä–∏—Ç–µ [SUPABASE_SETUP.md](./SUPABASE_SETUP.md) –¥–ª—è –ø–æ–¥—Ä–æ–±–Ω—ã—Ö –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π**

–ë—ã—Å—Ç—Ä–æ:
```bash
supabase db push
```

–ò–ª–∏ –≤—Ä—É—á–Ω—É—é –≤ [Supabase Dashboard](https://supabase.com/dashboard):
1. SQL Editor ‚Üí New query
2. –í—Å—Ç–∞–≤–∏—Ç—å —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ `supabase/migrations/init_database.sql`
3. Run

### 4. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env.local`:

```env
NEXT_PUBLIC_SUPABASE_URL=https://xxxxx.supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY=eyJxxxxxxx
ADMIN_EMAIL=admin@example.com
```

–ü–æ–ª—É—á–∏—Ç—å –∑–Ω–∞—á–µ–Ω–∏—è:
- –û—Ç–∫—Ä–æ–π—Ç–µ [Supabase Dashboard](https://supabase.com/dashboard)
- Project Settings ‚Üí API
- –°–∫–æ–ø–∏—Ä—É–π—Ç–µ `URL` –∏ `anon key`

### 5. –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

```bash
npm run dev
```

–û—Ç–∫—Ä–æ–π—Ç–µ [http://localhost:3000](http://localhost:3000)

---

## üìñ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
src/
‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îú‚îÄ‚îÄ page.tsx              # –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ (–≤—Ö–æ–¥/—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è)
‚îÇ   ‚îú‚îÄ‚îÄ dashboard/            # –î–∞—à–±–æ—Ä–¥ —Å —ç–ø–æ—Ö–∞–º–∏
‚îÇ   ‚îú‚îÄ‚îÄ lesson/[eraId]/       # –£—Ä–æ–∫–∏ –ø–æ —ç–ø–æ—Ö–µ
‚îÇ   ‚îú‚îÄ‚îÄ quiz/[lessonId]/      # –í–∏–∫—Ç–æ—Ä–∏–Ω–∞
‚îÇ   ‚îú‚îÄ‚îÄ map/                  # –ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∞—è –∫–∞—Ä—Ç–∞
‚îÇ   ‚îú‚îÄ‚îÄ admin/                # –ê–¥–º–∏–Ω–∫–∞ (—Ç–æ–ª—å–∫–æ –¥–ª—è admin@example.com)
‚îÇ   ‚îî‚îÄ‚îÄ profiles/[user_id]/   # –ü—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
‚îú‚îÄ‚îÄ components/
‚îÇ   ‚îú‚îÄ‚îÄ LoginForm.tsx         # –§–æ—Ä–º–∞ –≤—Ö–æ–¥–∞/—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
‚îÇ   ‚îú‚îÄ‚îÄ AdminForm.tsx         # —Ñ–æ—Ä–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–æ–Ω—Ç–µ–Ω—Ç–æ–º
‚îÇ   ‚îú‚îÄ‚îÄ ProtectedRoute.tsx    # –ó–∞—â–∏—Ç–∞ –æ—Ç –Ω–µ–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö
‚îÇ   ‚îî‚îÄ‚îÄ map/                  # –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –∫–∞—Ä—Ç—ã
‚îî‚îÄ‚îÄ utils/
    ‚îú‚îÄ‚îÄ supabase-client.ts    # –ö–ª–∏–µ–Ω—Ç –¥–ª—è –±—Ä–∞—É–∑–µ—Ä–∞
    ‚îî‚îÄ‚îÄ supabase-server.ts    # –ö–ª–∏–µ–Ω—Ç –¥–ª—è —Å–µ—Ä–≤–µ—Ä–∞
```

---

## üéÆ –§—É–Ω–∫—Ü–∏–∏

### ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ
- ‚úÖ –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∏ –≤—Ö–æ–¥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (email/–ø–∞—Ä–æ–ª—å, Google OAuth)
- ‚úÖ –ó–∞—â–∏—Ç–∞ –º–∞—Ä—à—Ä—É—Ç–æ–≤ (–Ω–µ–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –Ω–∞ –≤—Ö–æ–¥)
- ‚úÖ –î–∞—à–±–æ—Ä–¥ —Å —ç–ø–æ—Ö–∞–º–∏ –∏ –ø—Ä–æ–≥—Ä–µ—Å—Å–æ–º
- ‚úÖ –£—Ä–æ–∫–∏ —Å —Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ–º
- ‚úÖ –í–∏–∫—Ç–æ—Ä–∏–Ω—ã —Å –ø–æ–¥—Å—á–µ—Ç–æ–º –æ—á–∫–æ–≤
- ‚úÖ XP —Å–∏—Å—Ç–µ–º–∞ (+10 XP –∑–∞ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç –Ω–∞ –≤–æ–ø—Ä–æ—Å)
- ‚úÖ –ü—Ä–æ—Ñ–∏–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- ‚úÖ –ê–¥–º–∏–Ω–∫–∞ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–æ–Ω—Ç–µ–Ω—Ç–æ–º
- ‚úÖ –ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∞—è –∫–∞—Ä—Ç–∞ —Å –±–∏—Ç–≤–∞–º–∏ (Leaflet)
- ‚úÖ –°–∏—Å—Ç–µ–º–∞ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π (—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –≥–æ—Ç–æ–≤–∞)

### üîÑ –í —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ
- üîÑ RLS –ø–æ–ª–∏—Ç–∏–∫–∏ –≤ Supabase (–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å)
- üîÑ –°–∏—Å—Ç–µ–º–∞ streak (–¥–Ω–µ–≤–Ω–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å)
- üîÑ –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π
- üîÑ –†–µ–π—Ç–∏–Ω–≥ –ª–∏–¥–µ—Ä–æ–≤
- üîÑ –ú–æ–±–∏–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ

---

## üîê –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –∏ –∑–∞—â–∏—Ç–∞

**–í—Å–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –∫—Ä–æ–º–µ –≥–ª–∞–≤–Ω–æ–π —Ç—Ä–µ–±—É—é—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏:**

| –ú–∞—Ä—à—Ä—É—Ç | –¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ |
|---------|-----------|
| `/` | –û—Ç–∫—Ä—ã—Ç –¥–ª—è –≤—Å–µ—Ö |
| `/dashboard` | –ê–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å |
| `/lesson/...` | –ê–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å |
| `/quiz/...` | –ê–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å |
| `/map` | –ê–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å |
| `/profiles/[user_id]` | –ê–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å |
| `/admin` | –¢–æ–ª—å–∫–æ admin@example.com |

**–ö–æ–º–ø–æ–Ω–µ–Ω—Ç `ProtectedRoute`** –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é
- –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ñ–æ—Ä–º—É –≤—Ö–æ–¥–∞ –µ—Å–ª–∏ –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Ä–æ–ª—å –¥–ª—è –∞–¥–º–∏–Ω–∏–∫–∏

---

## üóÑÔ∏è –¢–∞–±–ª–∏—Ü—ã –ë–î

–°–º–æ—Ç—Ä–∏—Ç–µ [SUPABASE_SETUP.md](./SUPABASE_SETUP.md#—Å—Ç—Ä—É–∫—Ç—É—Ä–∞-—Ç–∞–±–ª–∏—Ü) –¥–ª—è –ø–æ–¥—Ä–æ–±–Ω–æ–≥–æ –æ–ø–∏—Å–∞–Ω–∏—è.

–û—Å–Ω–æ–≤–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã:
- `eras` - –≠–ø–æ—Ö–∏ –∏—Å—Ç–æ—Ä–∏–∏
- `lessons` - –£—Ä–æ–∫–∏
- `questions` - –í–æ–ø—Ä–æ—Å—ã –≤–∏–∫—Ç–æ—Ä–∏–Ω
- `user_profiles` - –ü—Ä–æ—Ñ–∏–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- `user_progress` - –ü—Ä–æ–≥—Ä–µ—Å—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `achievements` - –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è
- `user_achievements` - –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `historical_battles` - –ë–∏—Ç–≤—ã –Ω–∞ –∫–∞—Ä—Ç–µ

---

## üêõ –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### "–ü—Ä–æ—Ñ–∏–ª—å –Ω–µ —Å–æ–∑–¥–∞–Ω" –æ—à–∏–±–∫–∞

–≠—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ! –ü—Ä–æ—Ñ–∏–ª–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –Ω–µ —Å–æ–∑–¥–∞—é—Ç—Å—è. –°–æ–∑–¥–∞–π—Ç–µ –≤—Ä—É—á–Ω—É—é:

```sql
INSERT INTO user_profiles (id, level, xp, streak)
VALUES ('YOUR_USER_ID', 1, 0, 0);
```

–ì–¥–µ `YOUR_USER_ID` - UUID –∏–∑ —Ç–∞–±–ª–∏—Ü—ã `auth.users`.

### "406 PGRST116" –æ—à–∏–±–∫–∞

–û–∑–Ω–∞—á–∞–µ—Ç —á—Ç–æ –∑–∞–ø–∏—Å—å –Ω–µ –Ω–∞–π–¥–µ–Ω–∞. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ:
1. –¢–∞–±–ª–∏—Ü–∞ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç (–≤—ã–ø–æ–ª–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é)
2. –ü—Ä–æ—Ñ–∏–ª—å —Å–æ–∑–¥–∞–Ω –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
3. –ù–µ—Ç RLS –ø–æ–ª–∏—Ç–∏–∫ –±–ª–æ–∫–∏—Ä—É—é—â–∏—Ö –¥–æ—Å—Ç—É–ø

---

## üìù –ü—Ä–∏–º–µ—Ä—ã API

### –î–æ–±–∞–≤–∏—Ç—å XP –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é

```bash
curl -X POST http://localhost:3000/api/add-xp \
  -H "Content-Type: application/json" \
  -d '{
    "userId": "user-uuid",
    "xp": 50,
    "reason": "Quiz completed"
  }'
```

### –ü–æ–ª—É—á–∏—Ç—å –±–∏—Ç–≤—ã –∑–∞ –ø–µ—Ä–∏–æ–¥

```bash
curl "http://localhost:3000/api/battles?from=1000&to=1900"
```

---

## üí° –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞

### –ó–∞–ø—É—Å–∫ –≤ —Ä–µ–∂–∏–º–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

```bash
npm run dev
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–æ–≤

```bash
npx tsc --noEmit
```

### –õ–∏–Ω—Ç–∏–Ω–≥

```bash
npm run lint
```

### Build –¥–ª—è production

```bash
npm run build
npm run start
```

---

## üìß –ö–æ–Ω—Ç–∞–∫—Ç—ã

–î–ª—è –≤–æ–ø—Ä–æ—Å–æ–≤ –∏–ª–∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π —Å–æ–∑–¥–∞–≤–∞–π—Ç–µ Issues.

---

## üìÑ –õ–∏—Ü–µ–Ω–∑–∏—è

MIT
